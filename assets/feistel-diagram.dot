digraph feistel {
    rankdir=TB;
    node [shape=box, style=filled, fontname="Arial", fontsize=11, margin=0.15, height=0.4];
    edge [arrowsize=0.7];
    
    // Input
    input [label="Input: N bits", fillcolor="#e1f5ff", shape=ellipse];
    
    // Split
    subgraph cluster_0 {
        label="Split";
        style=rounded;
        color="#999999";
        margin=12;
        L1 [label="L₁\n(Left)", fillcolor="#ffe1e1"];
        R1 [label="R₁\n(Right)", fillcolor="#e1ffe1"];
        {rank=same; L1; R1;}
    }
    
    // Round 1
    subgraph cluster_1 {
        label="Round 1";
        style=rounded;
        color="#999999";
        margin=12;
        L2 [label="L₂", fillcolor="#ffe1e1"];
        F1 [label="F(R₁)", fillcolor="#fff4e1"];
        XOR1 [label="⊕", fillcolor="white", shape=circle, width=0.4, fixedsize=true];
        R2 [label="R₂", fillcolor="#e1ffe1"];
        {rank=same; L2; F1; XOR1; R2;}
    }
    
    // Round 2
    subgraph cluster_2 {
        label="Round 2";
        style=rounded;
        color="#999999";
        margin=12;
        L3 [label="L₃", fillcolor="#ffe1e1"];
        F2 [label="F(R₂)", fillcolor="#fff4e1"];
        XOR2 [label="⊕", fillcolor="white", shape=circle, width=0.4, fixedsize=true];
        R3 [label="R₃", fillcolor="#e1ffe1"];
        {rank=same; L3; F2; XOR2; R3;}
    }
    
    // Swap
    subgraph cluster_3 {
        label="Swap";
        style=rounded;
        color="#999999";
        margin=12;
        L4 [label="L₄", fillcolor="#ffe1e1"];
        R4 [label="R₄", fillcolor="#e1ffe1"];
        {rank=same; L4; R4;}
    }
    
    // Output
    output [label="Output: N bits", fillcolor="#e1f5ff", shape=ellipse];
    
    // Connections
    input -> L1 [weight=2];
    input -> R1 [weight=2];
    
    // Round 1
    L1 -> XOR1;
    R1 -> F1;
    R1 -> L2 [style=dashed, label="copy", fontsize=9];
    F1 -> XOR1;
    XOR1 -> R2;
    
    // Round 2
    L2 -> XOR2;
    R2 -> F2;
    R2 -> L3 [style=dashed, label="copy", fontsize=9];
    F2 -> XOR2;
    XOR2 -> R3;
    
    // Swap
    L3 -> R4 [label="swap", fontsize=9];
    R3 -> L4 [label="swap", fontsize=9];
    
    L4 -> output [weight=2];
    R4 -> output [weight=2];
}

